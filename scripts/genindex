#!/bin/bash
# genindex 1.0.0
# Generates this table of scripts here

# Define the output file
output_file="index.md"

# Start the Markdown table header
echo "# Scripts" > "$output_file"
printf "Useful shell scripts that can be called & run by copying the 'runner' script locally, and renaming it as the script you want to call. For instance, to run \`buildgo\`, download the \`runner\` script and rename it \`buildgo\`. Then when you run \`buildgo\` locally it will download the version here.\n\n" >> "$output_file"

echo "| Script Name | Version    | Comment               |" >> "$output_file"
echo "|-------------|------------|-----------------------|" >> "$output_file"

# Loop through all scripts in the directory
for script in *.sh *.bash *; do
    if [[ -f $script && $(head -n 1 "$script") == "#!/bin/bash" ]]; then
        if [[ $(head -n 3 "$script" | wc -l) -ge 3 ]]; then
            # Extract details from the first 3 lines of the script
            script_name=$(basename "$script")
            version=$(sed -n '2p' "$script" | awk '{print $NF}')
            comment=$(sed -n '3p' "$script" | sed 's/# //')
            
            # Make script name a Markdown link
            script_link="[$script_name]($script)"
            
            # Append to the Markdown table
            printf "| %-11s | %-10s | %-21s |\n" "$script_link" "$version" "$comment" >> "$output_file"
        fi
    fi
done

# Confirm completion
echo "Generated $output_file with script details."
