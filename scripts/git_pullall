#!/usr/bin/env bash
# git_pullall 1.3.4
# Do pull on all git repos

set -euo pipefail
Gre='\e[1;32m' Red='\e[1;31m' Mag='\e[1;35m' Yel='\e[1;33m' Blu='\e[1;34m' Rst='\e[0m'

for r in */; do
    repo="${r%/}"  # Remove trailing slash for display
    if [[ -d "$r/.git" ]]; then
        (
            cd "$r"
            if ! git ls-remote &>/dev/null; then
                printf "==> ${Red}%-35s${Rst} %s\n" "$repo" "Repository not found, skipping..."
                exit 0
            fi

            output=$(git pull 2>&1)

            if echo "$output" | grep -q "Already up to date."; then
                printf "==> ${Yel}%-35s${Rst} %s\n" "$repo" "Already up to date"
            else
                printf "==> ${Yel}%-35s${Rst}\n" "$repo"
                printf "%s\n" "$output"
            fi
        )
    fi
done
